# üì∏ ClientWhispererBot ‚Äî –§–æ—Ç–æ‚Äë–∫–æ–Ω—Å—å–µ—Ä–∂ –≤ Telegram

**ClientWhispererBot** ‚Äî Telegram‚Äë–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –±–µ—Ä–µ–∂–Ω–æ –±–µ—Ä—ë—Ç –Ω–∞ —Å–µ–±—è –ø–µ—Ä–≤–∏—á–Ω—É—é –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é —Å —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏: –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –≤–µ–¥—ë—Ç —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫–∏–π –æ–ø—Ä–æ—Å –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –∑–∞—è–≤–∫—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—É.

---

## ‚ú® –ß—Ç–æ —É–º–µ–µ—Ç –±–æ—Ç

- **–î–≤–∞ —Ä–µ–∂–∏–º–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é**: `üìù –ü—Ä–æ–π—Ç–∏ –æ–ø—Ä–æ—Å` –∏ `‚ÑπÔ∏è –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å`.
- **FAQ‚Äë–¥–≤–∏–∂–æ–∫**: –æ—Ç–≤–µ—Ç—ã —Å—Ç—Ä–æ–≥–æ –∏–∑ `knowledge_base.py` (–Ω–∏–∫–∞–∫–∏—Ö –≤—ã–¥—É–º–∞–Ω–Ω—ã—Ö —Ü–µ–Ω/—É—Å–ª–æ–≤–∏–π).
- **–û–ø—Ä–æ—Å (FSM)**: *—Å–∞–¥/—à–∫–æ–ª–∞ ‚Üí ‚Ññ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è ‚Üí –æ–±—â–∏–π/–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π ‚Üí —Å–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π ‚Üí –∫–æ–Ω—Ç–∞–∫—Ç (VK/WhatsApp)*, —Å–≤–æ–¥–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞.
- **–õ–∏–¥—ã**: –∑–∞—è–≤–∫–∏ –ø–∏—à—É—Ç—Å—è –≤ `data/leads.csv` –∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü—É –≤ Telegram (`OWNER_ID`).
- **–ü–∞–º—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞**: –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∏ –∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `data/sessions/<user_id>.json` –∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö GPT.
- **–ö–æ–Ω—Å—å–µ—Ä–∂‚Äë–æ–±—â–µ–Ω–∏–µ**: GPT –ø–æ–º–æ–≥–∞–µ—Ç ¬´–ø–æ‚Äë—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏¬ª, –Ω–æ **—Ü–µ–Ω—ã –∏ —É—Å–ª–æ–≤–∏—è –±–µ—Ä—ë—Ç —Ç–æ–ª—å–∫–æ –∏–∑ Facts** (–Ω–∞—à–µ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π). –ï—Å–ª–∏ —Ñ–∞–∫—Ç–∞ –Ω–µ—Ç ‚Äî —á–µ—Å—Ç–Ω–æ –ø–∏—à–µ—Ç, —á—Ç–æ —É—Ç–æ—á–Ω–∏—Ç —É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞.
- **–ü–æ–¥—Å–∫–∞–∑–∫–∏**: –µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ, –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ–º—ã –∫–Ω–æ–ø–∫–∞–º–∏.
- **–õ–æ–≥–∏**: –≤—Å—ë –ø–∏—à–µ—Ç—Å—è –≤ `logs/bot.log` –∏ `logs/dialog_log.txt`.

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ClientWhispererBot/
‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, 2‚Äë–∫–Ω–æ–ø–æ—á–Ω–æ–µ –º–µ–Ω—é
‚îú‚îÄ‚îÄ booking_router.py       # FSM‚Äë–æ–ø—Ä–æ—Å (—Å–∞–¥/—à–∫–æ–ª–∞, ‚Ññ, —Ç–∏–ø, –∫–æ–ª-–≤–æ, –∫–æ–Ω—Ç–∞–∫—Ç)
‚îú‚îÄ‚îÄ knowledge_base.py       # –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (—Ü–µ–Ω—ã, —É—Å–ª–æ–≤–∏—è, FAQ)
‚îú‚îÄ‚îÄ openai_helper.py        # –ö–æ–Ω—Å—å–µ—Ä–∂‚Äë–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç + ¬´–ø–µ—á–∞—Ç—å¬ª –ø–æ —Ü–µ–Ω–∞–º –∏–∑ Facts
‚îú‚îÄ‚îÄ memory_store.py         # –î–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–∏—Å—Ç–æ—Ä–∏—è, –ø—Ä–æ—Ñ–∏–ª—å)
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ leads.csv           # –ó–∞—è–≤–∫–∏ (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ   ‚îî‚îÄ‚îÄ sessions/           # JSON‚Äë—Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ logs/
‚îÇ   ‚îú‚îÄ‚îÄ bot.log             # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏
‚îÇ   ‚îî‚îÄ‚îÄ dialog_log.txt      # –ö–æ—Ä–æ—Ç–∫–∏–π log –¥–∏–∞–ª–æ–≥–æ–≤
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å –ø–∏–Ω–∞–º–∏ –≤–µ—Ä—Å–∏–π
‚îú‚îÄ‚îÄ .env                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤/–∫–ª—é—á–µ–π
‚îî‚îÄ‚îÄ README.md               # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1) –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
python -m venv venv
# Windows PowerShell:
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
./venv/Scripts/Activate.ps1
# Linux/Mac:
source venv/bin/activate
```

### 2) –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

> –í–∞–∂–Ω–æ: –∏–∑‚Äë–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ httpx —É–∫–∞–∂–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –≤–µ—Ä—Å–∏–∏.

```bash
pip install -U "openai>=1.40,<2" "httpx<0.28" aiogram>=3.4,<4 python-dotenv>=1.0 loguru>=0.7
```

–ò–ª–∏ —á–µ—Ä–µ–∑ `requirements.txt` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–µ—Ä–∂–∞—Ç—å —Ç–∞–∫ –∂–µ):

```
openai>=1.40,<2
httpx>=0.24,<0.28
aiogram>=3.4,<4
python-dotenv>=1.0
loguru>=0.7
```

### 3) –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `.env`

–°–æ–∑–¥–∞–π—Ç–µ `.env` –≤ –∫–æ—Ä–Ω–µ:

```env
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
OPENAI_API_KEY=–≤–∞—à_openai_api_key
OWNER_ID=–≤–∞—à_telegram_id   # —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∑–∞—è–≤–∫–∏ –≤ –õ–°
```

### 4) –ó–∞–ø—É—Å–∫

```bash
python main.py
```

–í –ª–æ–≥–∞—Ö —É–≤–∏–¥–∏—Ç–µ: `üöÄ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.`

---

## üß† –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (Facts)

–í—Å–µ —Ü–µ–Ω—ã –∏ —É—Å–ª–æ–≤–∏—è –∂–∏–≤—É—Ç –≤ `knowledge_base.py`. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–ª–æ–∫–æ–≤:

- `keywords` ‚Äî –∫–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã/—Ç—Ä–∏–≥–≥–µ—Ä—ã.
- `text` ‚Äî —Å–∞–º –æ—Ç–≤–µ—Ç (—Å —Ü–∏—Ñ—Ä–∞–º–∏/—É—Å–ª–æ–≤–∏—è–º–∏).
- `related_questions` ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏.
- `alias_mapping` ‚Äî —Å–∏–Ω–æ–Ω–∏–º—ã (—Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —Å–≤–æ–¥–∏–º –∫ –æ–¥–Ω–æ–º—É –∫–ª—é—á—É).

> –ü–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞.

---

## üó£Ô∏è –ö–∞–∫ –æ—Ç–≤–µ—á–∞–µ—Ç GPT

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ **–∫–æ–Ω—Å—å–µ—Ä–∂–∞** –¥–ª—è —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞.
- –í–∏–¥–∏—Ç **Client Profile** (—Å–∞–¥/—à–∫–æ–ª–∞, ‚Ññ, —Ç–∏–ø, –∫–æ–ª‚Äë–≤–æ, –∫–æ–Ω—Ç–∞–∫—Ç), —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –≤ `memory_store.py`.
- **–ù–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞** –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å —Ü–µ–Ω—ã ‚Äî —Å—Ç—Ä–æ–≥–æ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ Facts. –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç, —Å–Ω–∞—á–∞–ª–∞ —É—Ç–æ—á–Ω—è–µ—Ç, –∏–Ω–∞—á–µ –ø–∏—à–µ—Ç ¬´—É—Ç–æ—á–Ω—é —É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞¬ª.

–ö–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª:

- `/start`, `/menu` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.
- `/survey` –∏–ª–∏ `/book` ‚Äî –∑–∞–ø—É—Å–∫ –æ–ø—Ä–æ—Å–∞.
- `/ping` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ ¬´–∂–∏–≤ –ª–∏ –±–æ—Ç¬ª.

---

## üìù –û–ø—Ä–æ—Å (–±—ã—Å—Ç—Ä—ã–π —Å–±–æ—Ä –∑–∞—è–≤–∫–∏)

1. –í—ã–±–æ—Ä: **–¥–µ—Ç—Å–∫–∏–π —Å–∞–¥ / —à–∫–æ–ª–∞**.
2. **‚Ññ** —É—á—Ä–µ–∂–¥–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã).
3. –¢–∏–ø: **–û–±—â–∏–π / –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π**.
   - –ù–∞ –≤–æ–ø—Ä–æ—Å ¬´–≤ —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞?¬ª –±–æ—Ç –ø–æ–∫–∞–∂–µ—Ç –∫—Ä–∞—Ç–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ **—Å –≤–µ—Ä–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏** –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è.
4. –°–∫–æ–ª—å–∫–æ **–¥–µ—Ç–µ–π** –±–µ—Ä—É—Ç –∞–ª—å–±–æ–º—ã.
5. –ö–æ–Ω—Ç–∞–∫—Ç: **VK** (—Å—Å—ã–ª–∫–∞/@–Ω–∏–∫) –∏–ª–∏ **WhatsApp** (+7‚Ä¶).
6. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ ‚Üí –∑–∞–ø–∏—Å—å –≤ `leads.csv` ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü—É (`OWNER_ID`).

---

## üîí –î–∞–Ω–Ω—ã–µ –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

- –•—Ä–∞–Ω–∏—Ç—Å—è –º–∏–Ω–∏–º—É–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ: –ø—Ä–æ—Ñ–∏–ª—å/–∏—Å—Ç–æ—Ä–∏—è –≤ `data/sessions`, –∑–∞—è–≤–∫–∏ –≤ `data/leads.csv`.
- –í—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Google Sheets/Notion/n8n.

---

## üõ†Ô∏è –¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥

- **TypeError: AsyncClient.__init__() got an unexpected keyword argument 'proxies'** ‚Äî –æ–±–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç—ã:
  ```bash
  pip install -U "openai>=1.40,<2" "httpx<0.28"
  ```
- **–ö–æ–º–∞–Ω–¥—ã/–æ–ø—Ä–æ—Å –Ω–µ –ª–æ–≤—è—Ç—Å—è** ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `Dispatcher(storage=MemoryStorage())`, –∞ `booking_router` –ø–æ–¥–∫–ª—é—á—ë–Ω **–¥–æ** –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞.
- **–ö–∏—Ä–∏–ª–ª–∏—Ü–∞ –≤ PowerShell** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —à—Ä–∏—Ñ—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π UTF‚Äë8 –∏ `chcp 65001`.

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏ –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ.

---

## ü§ù –ò–¥–µ–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

- –≠–∫—Å–ø–æ—Ä—Ç –ª–∏–¥–æ–≤ –≤ Google Sheets/Notion (—á–µ—Ä–µ–∑ n8n).
- –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: `/whoami` (–ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞), `/forget` (–æ—á–∏—Å—Ç–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å/–∏—Å—Ç–æ—Ä–∏—é).
- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç —Å—É–º–º—ã –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–µ—Ç–µ–π –∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ç–∏–ø—É.
